# Телеком: прогноз оттока клиентов «ТелеДом»

Выпускной проект по предсказанию оттока абонентов оператора связи на основе персональных данных, тарифов и услуг.

---

## Описание проекта

Оператор связи **«ТелеДом»** хочет снижать отток клиентов. Для этого планируется предлагать промокоды и специальные условия тем, кто собирается отказаться от услуг. Чтобы заранее находить таких абонентов, нужна **модель, предсказывающая, разорвёт ли клиент договор**.

Команда оператора собрала:
- персональные данные клиентов;
- информацию о тарифах и оплате;
- данные об интернет- и телефонных услугах.

**Цель проекта:** обучить на этих данных модель для прогноза оттока клиентов.

---

## Описание услуг оператора

### Основные услуги

| Услуга | Описание |
|--------|----------|
| **Стационарная телефония** | Телефон можно подключить к нескольким линиям одновременно. |
| **Интернет** | Два типа: **DSL** (через телефонную линию) или **оптоволокно** (Fiber optic). |

### Дополнительные услуги

- **Интернет-безопасность:** антивирус (Device Protection), блокировка опасных сайтов (Online Security).
- **Техподдержка:** выделенная линия (Tech Support).
- **Облачное хранилище** для резервного копирования (Online Backup).
- **Стриминговое ТВ** (Streaming TV) и **каталог фильмов** (Streaming Movies).

**Оплата:** ежемесячно или раз в 1–2 года. Доступны разные способы расчёта и электронный чек.

---

## Описание данных

Данные хранятся в **SQLite** (один файл `.db`). База состоит из четырёх таблиц:

### Таблица `contract`

| Поле | Описание |
|------|----------|
| `customerID` | ID абонента |
| `BeginDate` | Дата начала действия договора |
| `EndDate` | Дата окончания действия договора |
| `Type` | Тип оплаты: раз в год–два или ежемесячно |
| `PaperlessBilling` | Электронный расчётный лист |
| `PaymentMethod` | Способ платежа |
| `MonthlyCharges` | Ежемесячные расходы |
| `TotalCharges` | Общие расходы абонента |

### Таблица `personal`

| Поле | Описание |
|------|----------|
| `customerID` | ID пользователя |
| `gender` | Пол |
| `SeniorCitizen` | Пенсионер (да/нет) |
| `Partner` | Наличие супруга/супруги |
| `Dependents` | Наличие иждивенцев (дети и т.п.) |

### Таблица `internet`

| Поле | Описание |
|------|----------|
| `customerID` | ID пользователя |
| `InternetService` | Тип подключения к интернету |
| `OnlineSecurity` | Блокировка опасных сайтов |
| `OnlineBackup` | Облачное хранилище для бэкапов |
| `DeviceProtection` | Антивирус |
| `TechSupport` | Выделенная линия техподдержки |
| `StreamingTV` | Стриминговое ТВ |
| `StreamingMovies` | Каталог фильмов |

### Таблица `phone`

| Поле | Описание |
|------|----------|
| `customerID` | ID пользователя |
| `MultipleLines` | Подключение телефона к нескольким линиям |

**Важно:** информация о договорах актуальна на **1 февраля 2020**.

---

## Структура проекта

```
Выпускной проект/
├── README.md                 # Этот файл
├── Выпускной проект.ipynb    # Основной ноутбук с анализом и моделями
├── ds-plus-final.db          # База данных SQLite (скачивается отдельно)
├── best_model_mps.pth        # Сохранённая модель (нейросеть PyTorch)
├── df_full_report.html       # HTML-отчёт по данным (опционально)
└── catboost_info/            # Логи обучения CatBoost
```

---

## Инструкция по выполнению (этапы проекта)

### Шаг 1. Загрузка данных

1. **Скачать базу данных** (если работаете не с локальным файлом):

   ```bash
   wget https://code.s3.yandex.net/data-scientist/ds-plus-final.db
   ```

   Либо скачать по ссылке вручную и положить файл `ds-plus-final.db` в папку проекта.

2. **Подключение к БД в ноутбуке:**

   ```python
   import os
   import pandas as pd
   from sqlalchemy import create_engine

   path_to_db = 'ds-plus-final.db'
   engine = create_engine(f'sqlite:///{path_to_db}', echo=False)
   ```

3. **Задать константу воспроизводимости:**  
   Например, `RANDOM_STATE = 20226` (или дата начала работы в формате ДДММГГ). Использовать её при `train_test_split`, в моделях и при подборе гиперпараметров.

---

### Шаг 2. Исследовательский анализ и предобработка

- **Проверка данных:**
  - Все ли нужные таблицы есть и не пустые.
  - Соответствие количества таблиц заданию (contract, personal, internet, phone).

- **По каждой таблице:**
  - EDA: пропуски, аномалии, распределения.
  - Обработка аномалий с учётом специфики телекома.

- **Объединение по `customerID`:**
  - Одно наблюдение на клиента.
  - Учёт особенностей услуг (например, не у всех есть интернет/телефон).

- **Новые признаки:**
  - Например, **длительность контракта** (по `BeginDate` и дате актуальности данных).
  - Целевая переменная — из **`EndDate`** (уход/не уход).

- **EDA объединённой таблицы:**
  - Заполнение пропусков при необходимости.
  - Визуализация распределений признаков.
  - Соотношение ушедших и оставшихся по каждому признаку.
  - Корреляционный анализ (в т.ч. можно Phi_k).

- **Подготовка к обучению:**
  - Выбор признаков без утечки (не использовать даты как вход модели; не смешивать длительность контракта с другими производными от `BeginDate`).
  - Разделение на train/test, например `test_size=0.25`, с учётом `RANDOM_STATE`.
  - Подготовка выборок под выбранные модели (кодирование, масштабирование и т.д.).

---

### Шаг 3. Обучение модели

- **Классы моделей:**
  - Решающее дерево / случайный лес.
  - Бустинги (например, CatBoost).
  - Нейронные сети.

- **Критерий выбора:** максимизация **ROC-AUC** на кросс-валидации.

- **Гиперпараметры:** подбор хотя бы по двум гиперпараметрам для одной модели. Рекомендуется автоматизация: `GridSearchCV`, `RandomizedSearchCV`, Optuna и т.п.

---

### Шаг 4. Тестирование и интерпретация

- **Качество на тесте:**
  - **ROC-AUC ≥ 0.85** (обязательное требование).
  - Дополнительно — **accuracy** для интерпретируемости.

- **Визуализация:**
  - Матрица ошибок (confusion matrix).
  - График полноты и точности (Precision–Recall).

- **Важность признаков:**
  - Анализ основных входных признаков, влияющих на отток.

- **Детальный разбор одного признака:**
  - График зависимости выбранного признака и целевой переменной.

---

### Шаг 5. Общие выводы

- Итоги по качеству модели и выбранному решению.
- Идеи по улучшению модели и данных.
- **Бизнес-рекомендации** для «ТелеДома»: как использовать модель и на что обратить внимание в удержании клиентов.

---

## Результаты (из ноутбука)

- **Лучшая модель:** CatBoost (с подбором гиперпараметров, в т.ч. через RandomizedSearchCV).
- **ROC-AUC на кросс-валидации:** ~0.966.
- **ROC-AUC на тестовой выборке:** ~0.967 (требование ≥ 0.85 выполнено).
- **Дополнительно:** проверены Random Forest, логистическая регрессия и нейросеть (PyTorch); нейросеть показала результат на уровне CatBoost.
- **Важные признаки:** среди прочего — `TotalCharges`, длительность контракта; экономические и «длительность отношений» важнее части демографических признаков.

---

## Зависимости

В проекте используются, в частности:

- `pandas`, `numpy`, `sqlalchemy`
- `scikit-learn` (модели, разбиение, метрики, пайплайны)
- `catboost`
- `torch` (нейросеть)
- `matplotlib`, `seaborn`
- `phik` (корреляции)
- `ydata_profiling` (опционально, для отчётов)
- `imblearn` (при необходимости работы с дисбалансом)

Установка окружения — через `pip` или `conda` по списку импортов в ноутбуке; при необходимости можно оформить `requirements.txt` в папке проекта.

---

## Как запустить

1. Установить зависимости (Python 3.8+).
2. Положить `ds-plus-final.db` в папку с ноутбуком или указать правильный `path_to_db`.
3. Открыть и выполнить ячейки в `Выпускной проект.ipynb` по порядку.

---

## Лицензия и авторство

Учебный проект в рамках курса Data Science (Яндекс Практикум). Данные — учебные.
